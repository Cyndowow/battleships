(()=>{"use strict";class t{constructor(t){this.length=t,this.tiles=[...Array(t).keys()],this.domTargets=[]}hit(t){if("hit"===this.tiles[t])return!1;this.tiles.splice(t,1,"hit")}isSunk(){let t=!1;return this.tiles.forEach((e=>{"hit"!==e&&(t=!0)})),!0!==t}}class e{constructor(){this.board=[],this.isStartAllowed=!1,this.hasStarted=!1,this.create()}create(){for(let t=0;t<10;t++){this.board[t]=[];for(let e=0;e<10;e++)this.board[t].push(!1)}}getStartAllowed(){return this.isStartAllowed}setStartAllowed(t){this.isStartAllowed=t}receiveAttack(t,e){return"miss"!==this.board[t][e]&&("object"!=typeof this.board[t][e]||"hit"!==this.board[t][e].ship.tiles[this.board[t][e].shipPos])&&(this.board[t][e]&&"res"!==this.board[t][e]?(this.board[t][e].ship.hit(this.board[t][e].shipPos),this.board[t][e].ship.tiles[this.board[t][e].shipPos]):(this.board[t][e]="miss",this.board[t][e]))}placeShip(e,r,s,i){if(this.board[e][r])return!1;let a=new t(s),o=0;if("h"===i){if(r+a.length>10)return!1;for(let t=0;t<s;t++)if("res"===this.board[e][r+t])return!1;for(let t=r;t<r+a.length;t++)this.board[e].splice(t,1,{ship:a,shipPos:o}),this.reserveAround(e,r+o),o++}if("v"===i){if(e+a.length>10)return!1;for(let t=0;t<s;t++)if("res"===this.board[e+t][r])return!1;for(let t=e;t<e+a.length;t++)this.board[t].splice(r,1,{ship:a,shipPos:o}),this.reserveAround(e+o,r),o++}}reserveAround(t,e){let r=this.board;function s(s,i){t+s>9||t+s<0||!1===r[t+s][e+i]&&(r[t+s][e+i]="res")}function i(t){s(t,-1),s(t,0),s(t,1)}i(-1),i(0),i(1)}isSunk(t,e){return!0===this.board[t][e].ship.isSunk()}areAllSunk=t=>{let e=!1;for(let r=0;r<10;r++)t[r].forEach((t=>{t&&"miss"!==t&&"res"!==t&&!1===t.ship.isSunk()&&(e=!0)}));return!0!==e}}class r{constructor(t){this.name=t,this.ships=[],this.gameBoard=new e,this.turn=!1}fireShot(t,e,r){return t.gameBoard.receiveAttack(e,r)}isTurn(t){this.turn=!0,t.turn=!1}getTurn(){return this.turn}setTurn(t){this.turn=t}randomPos(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}createFleet(){const e=[2,3,3,4,5];for(const r of e)this.ships.push(new t(r))}placeShipRandomly(t){let e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),s=Math.round(Math.random());return(0!==s||(s="h",0!=this.gameBoard.placeShip(e,r,t,s)))&&(1!==s||(s="v",0!=this.gameBoard.placeShip(e,r,t,s)))&&void 0}placeRandomFleet(){this.createFleet(),this.ships.forEach((t=>{0==this.placeShipRandomly(t.length)&&this.placeShipRandomly(t.length)})),this.gameBoard.setStartAllowed(!0)}}let s,i;document.getElementById("start").addEventListener("click",(()=>(s=new r("You"),i=new r("Your enemy"),void function(t,e){for(let r=0;r<10;r++){let s=document.createElement("div");s.classList.add("row-p1"),s.setAttribute("id",`p1-row${r}`),document.getElementById("playerBoard").appendChild(s),t.gameBoard.board[r].forEach(((i,a)=>{let o=document.createElement("div");o.classList.add("cell-p1"),o.setAttribute("id",`p1-row${r}-cell${a}`),s.appendChild(o),o.addEventListener("click",(s=>{t.getTurn()&&t.gameBoard.getStartAllowed()&&renderAttackP1(s,r,a,t,e)}))}))}for(let e=0;e<10;e++){let r=document.createElement("div");r.classList.add("row-p2"),r.setAttribute("id",`p2-row${e}`),document.getElementById("enemyBoard").appendChild(r),t.gameBoard.board[e].forEach(((t,s)=>{let i=document.createElement("div");i.classList.add("cell-p2"),i.setAttribute("id",`p2-row${e}-cell${s}`),r.appendChild(i)}))}}(s,i))))})();